!function(t,e){var s=!0;function i(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}t.extend(i.prototype,{_isOpenSelectbox:function(t){return!!t&&this._getInst(t).isOpen},_isDisabledSelectbox:function(t){return!!t&&this._getInst(t).isDisabled},_attachSelectbox:function(e,i){if(this._getInst(e))return!1;var n,l,a,o,c=t(e),d=this,p=d._newInst(c),r=!1,b=(c.find("optgroup"),c.find("option")),u=b.length;function g(){var e,s=this.attr("id").split("_")[1];for(e in d._state)e!==s&&d._state.hasOwnProperty(e)&&t(":input[sb='"+e+"']")[0]&&d._closeSelectbox(t(":input[sb='"+e+"']")[0])}function _(){var i=!(!arguments[1]||!arguments[1].sub),n=!(!arguments[1]||!arguments[1].disabled);arguments[0].each(function(c){var b,g=t(this),_=t("<li>");g.is(":selected")&&(l.text(g.text()),r=s),c===u-1&&_.addClass("last"),g.is(":disabled")||n?(b=t("<span>",{text:g.text()}).addClass(p.settings.classDisabled),i&&b.addClass(p.settings.classSub),b.appendTo(_)):(b=t("<a>",{href:"#"+g.val(),rel:g.val(),text:g.text(),click:function(s){s.preventDefault();a.attr("id").split("_")[1];d._changeSelectbox(e,t(this).attr("rel"),t(this).text()),d._closeSelectbox(e)}}),i&&b.addClass(p.settings.classSub),b.appendTo(_)),_.appendTo(o)})}c.attr("sb",p.uid),t.extend(p.settings,d._defaults,i),d._state[p.uid]=!1,c.hide(),n=t("<div>",{id:"sbHolder_"+p.uid,class:p.settings.classHolder}),l=t("<a>",{id:"sbSelector_"+p.uid,href:"#",class:p.settings.classSelector,mouseenter:function(s){s.preventDefault(),g.apply(t(this),[]);var i=t(this).attr("id").split("_")[1];d._state[i]?d._closeSelectbox(e):d._openSelectbox(e)}}),(a=t("<a>",{id:"sbToggle_"+p.uid,href:"#",class:p.settings.classToggle,mouseenter:function(s){s.preventDefault(),g.apply(t(this),[]);var i=t(this).attr("id").split("_")[1];d._state[i]?d._closeSelectbox(e):d._openSelectbox(e)}})).appendTo(n),o=t("<ul>",{id:"sbOptions_"+p.uid,class:p.settings.classOptions,css:{display:"none"}}),c.children().each(function(e){var s,i=t(this),n={};i.is("option")?_(i):i.is("optgroup")&&(s=t("<li>"),t("<span>",{text:i.attr("label")}).addClass(p.settings.classGroup).appendTo(s),s.appendTo(o),i.is(":disabled")&&(n.disabled=!0),n.sub=!0,_(i.find("option"),n))}),r||l.text(b.first().text()),t.data(e,"selectbox",p),l.appendTo(n),o.appendTo(n),n.insertAfter(c)},_detachSelectbox:function(e){var s=this._getInst(e);if(!s)return!1;t("#sbHolder_"+s.uid).remove(),t.data(e,"selectbox",null),t(e).show()},_changeSelectbox:function(e,i,n){var l=this._getInst(e),a=this._get(l,"onChange");t("#sbSelector_"+l.uid).text(n),t(e).find("option[value='"+i+"']").attr("selected",s),a?a.apply(l.input?l.input[0]:null,[i,l]):l.input&&l.input.trigger("change")},_enableSelectbox:function(e){var s=this._getInst(e);if(!s||!s.isDisabled)return!1;t("#sbHolder_"+s.uid).removeClass(s.settings.classHolderDisabled),s.isDisabled=!1,t.data(e,"selectbox",s)},_disableSelectbox:function(e){var i=this._getInst(e);if(!i||i.isDisabled)return!1;t("#sbHolder_"+i.uid).addClass(i.settings.classHolderDisabled),i.isDisabled=s,t.data(e,"selectbox",i)},_optionSelectbox:function(e,s,i){var n=this._getInst(e);if(!n)return!1;n[s]=i,t.data(e,"selectbox",n)},_openSelectbox:function(e){var i=this._getInst(e);if(i&&!i.isOpen&&!i.isDisabled){var n=t("#sbOptions_"+i.uid),l=parseInt(t(window).height(),10),a=t("#sbHolder_"+i.uid).offset(),o=t(window).scrollTop(),c=n.prev().height(),d=l-(a.top-o)-c/2,p=this._get(i,"onOpen");n.css({top:c+"px",maxHeight:d-c+"px"}),"fade"===i.settings.effect?n.fadeIn(i.settings.speed):n.slideDown(i.settings.speed),t("#sbToggle_"+i.uid).addClass(i.settings.classToggleOpen),this._state[i.uid]=s,i.isOpen=s,p&&p.apply(i.input?i.input[0]:null,[i]),t.data(e,"selectbox",i)}},_closeSelectbox:function(e){var s=this._getInst(e);if(s&&s.isOpen){var i=this._get(s,"onClose");"fade"===s.settings.effect?t("#sbOptions_"+s.uid).fadeOut(s.settings.speed):t("#sbOptions_"+s.uid).slideUp(s.settings.speed),t("#sbToggle_"+s.uid).removeClass(s.settings.classToggleOpen),this._state[s.uid]=!1,s.isOpen=!1,i&&i.apply(s.input?s.input[0]:null,[s]),t.data(e,"selectbox",s)}},_newInst:function(t){return{id:t[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:t,uid:Math.floor(99999999*Math.random()),isOpen:!1,isDisabled:!1,settings:{}}},_getInst:function(e){try{return t.data(e,"selectbox")}catch(t){throw"Missing instance data for this selectbox"}},_get:function(t,e){return void 0!==t.settings[e]?t.settings[e]:this._defaults[e]}}),t.fn.selectbox=function(e){var s=Array.prototype.slice.call(arguments,1);return"string"==typeof e&&"isDisabled"==e?t.selectbox["_"+e+"Selectbox"].apply(t.selectbox,[this[0]].concat(s)):"option"==e&&2==arguments.length&&"string"==typeof arguments[1]?t.selectbox["_"+e+"Selectbox"].apply(t.selectbox,[this[0]].concat(s)):this.each(function(){"string"==typeof e?t.selectbox["_"+e+"Selectbox"].apply(t.selectbox,[this].concat(s)):t.selectbox._attachSelectbox(this,e)})},t.selectbox=new i,t.selectbox.version="0.1.3"}(jQuery);